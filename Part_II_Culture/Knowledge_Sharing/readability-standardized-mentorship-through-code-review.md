# 可读性：通过代码审核进行标准化指导

在谷歌，“可读性”不仅仅指代码可读性；他是谷歌内部为了编程语言的最佳传播的而规范化了的指导过程。可读性涵盖很宽泛的专业领域，包括但不限于语言习语、代码结构、API 设计、公共库的适当使用、文档和测试覆盖率。

可读性始于一个人的努力。在谷歌发展的早期，克雷格·西尔弗斯坦（员工 ID #3）会亲自与每个新员工坐下来，对他们的第一个主要代码提交进行逐行“可读性审核”。这是一个吹毛求疵的审核，涵盖了从代码改进的方式到空格的方方面面。这使 Google 的代码库具有统一的外观，但更重要的是，它传授了最佳实践，突出了共享基础架构是可能的，并向新员工展示了在 Google 编写代码的感觉。

不可避免地，谷歌的招聘率超出了一个人可以跟上的速度。如此多的工程师发现这个过程很有价值，以至于他们自愿抽出时间来参与这项活动。今天，大约 20% 的 Google 工程师在任何特定时间都参与了可读性流程，无论是作为审阅者还是作为写代码的人。


什么是可读性过程？

在 Google，代码审查是强制性的。每个更改列表 (CL)18 需要 可读性审核，这将表明有可读性认证的专家已批准该编程语言的变更。认证专家为他们自己的 CL 提供内部的可读性批准；否则，一名或多名合格的审阅者必须公开批准 CL 的可读性。这一要求是在 Google 发展到无法再强制要求每个工程师都接受将该最佳实践传授到所需要的严谨的代码审核之后添加的。

    看 第 9 章 有关 Google 代码审查流程的概述以及 批准在此上下文中的含义。

在 Google 内部，具有可读性认证通常被认为具有一种语言的“可读性”。具有可读性的工程师已经证明，他们始终如一地编写清晰、惯用且可维护的代码，这些代码体现了 Google 针对既定语言的最佳实践和编码风格。他们通过可读性过程提交 CL 来做到这一点，在此过程中，由一组集中的可读性审查人员 审查 CL，并展现了它对各种领域的掌握程度。随着作者将可读性指南内化，他们收到的关于 CL 的评论越来越少，直到他们最终从这一过程中毕业并正式获得可读性。可读性带来了更多的责任。拥有了可读性的工程师将受到信任，以继续将自己的知识运用到自己的代码，并作为评审对其他工程师的代码进行审核。

大约 1% 到 2% 的 Google 工程师是可读性评审员。所有的审核员都是自愿的，并欢迎任何人自荐成为可读性审阅员。可读性审核员有着最高的要求。因为他们不仅要求有深厚的专业语言，也要同时拥有通过代码审核传授他人知识的能力。他们应该首先将可读性视为指导和合作的一个过程，而不是把关或对立的过程。鼓励可读性审阅者和 CL 作者在审阅过程中进行讨论。审稿人为他们的意见提供相关的引用，以便作者可以了解风格指南（“Chesterson’s fence”）中的基本原理。如果任何给定指南的理由不明确，代码作者应要求澄清（“提问题”）。

    一个 变更 是文件组成的版本控制系统的改变的列表。变更列表是 a 的同义词 变更集。


可读性：通过代码审查的标准化指导|63

可读性是一个人为驱动的过程，旨在以标准化但个性化的方式扩展知识。作为互补交融的书面和部落知识，可读性结合了书面材料的可引用参考文献的优势与专家人工审核者能够明确应该引用哪部分规范的优势。规范指南和语言建议被全面记录，这虽然很好！但是信息的语料库太大了，以至于它可能会让人不知所措，尤其是对新手来说。


为什么有这个过程？

代码的阅读量远远超过编写量，且这种影响在 Google 的规模和我们的（非常大的）monorepo 中被放大了。20 任何工程师都可以查看和学习来自其他团队代码的丰富知识，以及强大的工具，例如 Kythe 使得在整个代码库中查找引用变得容易（参见 第 17 章）。记录在案的最佳实践的一个重要之处（参见 第 8 章）是它们为所有 Google 代码提供了一致的标准。可读性既是这些标准的执行机制，也是传播机制。

可读性程序的主要优点之一是它使工程师不仅仅了解他们自己团队的部落知识。为了获得某一给定语言的可读性，工程师必须向一组集中的可读性审查员发送CLs，这些审查员会审查整个公司的代码。集中化流程是一个重要的权衡：该计划仅限于线性扩展，而不是随着公司的增长而亚线性扩展，但它可以更容易地实现一致性，避免孤岛，并避免（通常是无意的）偏离既定规范。

代码库范围内的一致性的价值怎么强调都不为过：即使数十万工程师编写代码数十年，它也能确保给定语言的代码在整个语料库中看起来相似。这使读者能够专注于代码的作用，而不是因为它看起来与他们习惯的代码不同而分心。

大规模变更作者（参见第 22 章）可以更轻松地跨整个 monorepo 进行变更，跨越数千个团队的界限。人们可以改变团队并确信新团队使用给定语言的方式与他们以前的团队没有太大的不同。

    截至 2019 年，仅 Google C++ 风格指南就有 40 页长。构成完整最佳实践语料库的辅助材料要长很多倍。
    有关 Google 使用 monorepo 的原因，请参阅 https://cacm.acm.org/magazines/2016/7/204032-why-google-stores-billions-of-lines-of-code-in-a-single-repository/fulltext。另请注意，并非所有 Google 的代码都存在于知识库；此处描述的可读性仅适用于 monorepo，因为它是存储库内一致性的概念。

这些好处伴随着一些成本：与文档和类等其他媒介相比，可读性是一个重量级的过程，因为它是强制性的，并且由 Google 工具强制执行（见 第 19 章）。这些代价非常重要，包括以下内容：

    • 不具有可读性审核员的团队成员摩擦增加，因为他们需要找到自己的团队外的审核者给出的CL可读性审批。
    • 对需要可读性审查的作者进行额外几轮代码审查的可能性。
    • 人为驱动过程的规模化缺点。仅限于线性扩展以适应公司的增长，因为它依赖于人类审查人员进行专门的代码审查。

那么，问题是收益是否大于成本。还有时间因素：收益与成本的全部影响不在同一时间范围内。该计划有意权衡增加的短期代码审查延迟和前期成本，以获得更高质量代码、存储库范围的代码一致性和增加的工程师专业知识的长期回报。更长的时间范围伴随着期望编写代码的潜在生命周期为数年，即使不是数十年的话。21

与大多数（或者可能是所有）工程流程一样，总还有改进的余地。一些成本可以通过工具来减轻。
许多可读性注释解决了可以静态检测并由静态分析工具自动注释的问题。随着我们继续投资于静态分析，可读性审阅者可以越来越多地集中于高阶领域，不熟悉代码库的外部读者是否可以理解特定的代码块，而不是自动检测，例如一行是否有尾随空格。


但仅有抱负还不够。可读性审核是一个有争议的项目：一些工程师抱怨这是一个不必要的官僚障碍和对工程师时间的不当利用。可读性的权衡是否值得？对于答案，我们求助于我们值得信赖的工程生产力研究 (EPR) 团队。

因此，已知具有短时间跨度的代码不受可读性要求的约束。考试- 普莱斯包括 实验/ 目录（明确指定的实验代码并不能推到亲- duction）和 120 区计划，Google 实验产品的研讨会。


可读性：通过代码审查的标准化指导

EPR 团队对可读性进行了深入研究，包括但不限于人们在毕业后是否受到过程的阻碍、学到了什么或改变了他们的行为。这些研究表明，可读性对工程速度有积极的影响。具有可读性的作者的 CL 在统计上比没有可读性的作者的 CL 花费的时间要少得多。22 自我报告的工程师对其代码质量的满意度——缺乏更客观的代码质量衡量标准——在具有可读性的工程师中高于那些没有可读性的工程师。绝大多数完成实践的工程师都表示对该过程感到满意并认为它值得。他们报告从审阅者那里学习并改善自己的行为，以避免在编写和审阅代码时出现可读性问题。

    想深入了解谷歌的内部工程师- 荷兰国际集团的生产力的研究，请看 第 7 章。

Google 拥有非常强大的代码审核文化，而可读性是这种文化的自然延伸。可读性从单个工程师的热情发展为由人类专家指导所有 Google 工程师的正式活动。它随着 Google 的发展而发展和变化，并且随着 Google 需求的变化而不断发展。

结论

知识在某些方面是软件工程公司最重要的（尽管是无形的）资本，而知识的共享对于使公司在面对变化时具有弹性和冗余性至关重要。促进开放和诚实的知识共享的文化可以在整个公司中有效地分配知识，并允许该公司随着时间的推移而扩展。在大多数情况下，对更轻松的知识共享的投资在公司的整个生命周期中都会获得多倍的收益。

这包括控制各种因素，包括在 Google 的任期以及与已经具有可读性的作者相比，不具有可读性的作者的 CL 通常需要额外的审查轮次这一事实。


TL;DRs

    • 心理安全 是营造知识共享环境的基础。
    • 从小处着手：提出问题并写下来。
    • 使人们可以轻松地从人类专家和文档参考中获得所需的帮助。
    • 在系统层面，鼓励和奖励那些花时间教授和扩展他们的专业知识的人，而不仅仅是他们自己、他们的团队或他们的公司。
    • 没有灵丹妙药：授权知识共享文化需要多种策略的组合，而最适合您的公司的确切组合可能会随着时间而改变。
